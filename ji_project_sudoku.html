<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="title" content="Sudoku Solver">
    <meta name="author" content="Janne">
    <meta name="description" content="Janne's sudoku solver">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>Sudoku Solver</title>
    <link rel="stylesheet" href="ji_styles.css">
</head>

<body class="background_image" style="background-image: url('sudo_background_stars.webp')">
    <!--source: https://opengameart.org/sites/default/files/Starbasesnow_0.png-->
    <form class="max_width">
        <div style="text-align: center">
            <img class="top_image" src="sudo_top.webp" alt=""
                title="source: https://www.peakpx.com/524599/yellow-pencil-sudoku-paper/1280x720-wallpaper">
        </div>
        <h1 class="top_h1 header_outline_orange" style="color: rgb(45, 45, 158);">
            Sudoku Solver
        </h1>
        <div class="projects_div text_outline_black">
            <a class="links_background links" href='index.html'><b>Home</b></a>
            <a class="links_background links" href='ji_project_patties.html'><b>Pike Patties</b></a>
            <a class="links_background links" href='ji_project_sudoku.html'><b>Sudoku Solver</b></a>
        </div>
        <br>
        <div class="search_div">
            <input type="text" id="search" placeholder="Search for page titles!">
            <input type="button" value="Search" onClick="searchFor()">
        </div>
    </form>
    <form class="search_results">
        <div style="text-align: center">
            <p id="results" style="text-align: left; background-color: rgb(255, 255, 255, 0.8)"></p>
        </div>
    </form>
    <form style="text-align: center">
        <div class="project_image">
            <img class="project_image" src="sudo_project.gif" alt=""
                title="source: https://en.wikipedia.org/wiki/File:Sudoku_solved_by_bactracking.gif">
        </div>
        <!--background-color:rgb(192, 192, 219);-->
        <div class="project_text">
            <h1 class="text_outline_orange">The Algorithm</h1>
            <!--background-color:rgb(192, 192, 219, 0.8)-->

            <div class="text_outline_black" style="padding-bottom: 19px;font-size: 17px; color:azure;">
                This is a showcase of a recursive backtracking brute force sudoku solver algorithm. <br>
                In addition to the solver function, there are multiple helper functions for validation and printing, but
                the interesting stuff happens in the solver. <br>
                The original implemenetation I worked on was written in C for a group project, and this follows mostly
                the same logic translated into JavaScript.<br><br>
                It's the best known sudoku solver method and a good general showcase for a recursive backtracker.
            </div>
        </div>
    </form>
    <form class="max_width">
        <div style="text-align: center">
            <input type="button" value="Toggle Code Display" onClick="codeDisplay()">
        </div>
        <div class="max_width_noscale">
            <pre id="codeDisplay" style="text-align: left; background-color: rgb(255, 255, 255)"></pre>
        </div>
        <div class="text_outline_black" style="margin-bottom: 38px; padding-bottom: 4px; color:azure;">
            <h2 style="text-align: center; color:orange">Explanation</h2>
            <ul style="font-size: 17px">
                <li>The solver gets a single cell's coordinates as parameters and determines if that cell meets the
                    criteria
                    to call itself with the next cell's coordinates</li>
                <li>The solver saves the currently looked at value 1-9 in the current cell before recursive call and
                    wipes it if a fail state is returned
                    <ul>
                        <li>This solves the issue of keeping track of the progress since any failed branch unravels into
                            its starter state</li>
                    </ul>
                </li>
                <li>The function goes through the cells until the sudoku has been confirmed having no solutions, having
                    more than 1 solution, or having exactly 1 solution</li>
                <li>At any of those points no further calls are made, and another function prints the sudoku status
                    based on
                    global vairables saved in key conditions during the solver calls
                    <ul>
                        <li>Solutions count: add +1 each time end condition is met up to 2</li>
                        <li>Solved sodoku: copy from the currently analyzed sudoku when end condition is met for the
                            first time</li>
                    </ul>
                </li>
            </ul>
        </div>
        <!--background-color: rgb(250, 235, 215, 1)-->
        <div style="background-color: rgb(78, 52, 75, 0.8); padding-bottom: 38px; border-radius: 20%">
            <h2 style="text-align: center; color:antiquewhite; padding-top: 19px;">Try it in practice: fill and click
                solve!</h2>
            <div class="input_field">
                    <input type="text" id="i00" style="width: 17px">
                    <input type="text" id="i01" style="width: 17px">
                    <input type="text" id="i02" style="width: 17px">
                    <input type="text" id="i03" style="width: 17px">
                    <input type="text" id="i04" style="width: 17px">
                    <input type="text" id="i05" style="width: 17px">
                    <input type="text" id="i06" style="width: 17px">
                    <input type="text" id="i07" style="width: 17px">
                    <input type="text" id="i08" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i10" style="width: 17px">
                    <input type="text" id="i11" style="width: 17px">
                    <input type="text" id="i12" style="width: 17px">
                    <input type="text" id="i13" style="width: 17px">
                    <input type="text" id="i14" style="width: 17px">
                    <input type="text" id="i15" style="width: 17px">
                    <input type="text" id="i16" style="width: 17px">
                    <input type="text" id="i17" style="width: 17px">
                    <input type="text" id="i18" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i20" style="width: 17px">
                    <input type="text" id="i21" style="width: 17px">
                    <input type="text" id="i22" style="width: 17px">
                    <input type="text" id="i23" style="width: 17px">
                    <input type="text" id="i24" style="width: 17px">
                    <input type="text" id="i25" style="width: 17px">
                    <input type="text" id="i26" style="width: 17px">
                    <input type="text" id="i27" style="width: 17px">
                    <input type="text" id="i28" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i30" style="width: 17px">
                    <input type="text" id="i31" style="width: 17px">
                    <input type="text" id="i32" style="width: 17px">
                    <input type="text" id="i33" style="width: 17px">
                    <input type="text" id="i34" style="width: 17px">
                    <input type="text" id="i35" style="width: 17px">
                    <input type="text" id="i36" style="width: 17px">
                    <input type="text" id="i37" style="width: 17px">
                    <input type="text" id="i38" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i40" style="width: 17px">
                    <input type="text" id="i41" style="width: 17px">
                    <input type="text" id="i42" style="width: 17px">
                    <input type="text" id="i43" style="width: 17px">
                    <input type="text" id="i44" style="width: 17px">
                    <input type="text" id="i45" style="width: 17px">
                    <input type="text" id="i46" style="width: 17px">
                    <input type="text" id="i47" style="width: 17px">
                    <input type="text" id="i48" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i50" style="width: 17px">
                    <input type="text" id="i51" style="width: 17px">
                    <input type="text" id="i52" style="width: 17px">
                    <input type="text" id="i53" style="width: 17px">
                    <input type="text" id="i54" style="width: 17px">
                    <input type="text" id="i55" style="width: 17px">
                    <input type="text" id="i56" style="width: 17px">
                    <input type="text" id="i57" style="width: 17px">
                    <input type="text" id="i58" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i60" style="width: 17px">
                    <input type="text" id="i61" style="width: 17px">
                    <input type="text" id="i62" style="width: 17px">
                    <input type="text" id="i63" style="width: 17px">
                    <input type="text" id="i64" style="width: 17px">
                    <input type="text" id="i65" style="width: 17px">
                    <input type="text" id="i66" style="width: 17px">
                    <input type="text" id="i67" style="width: 17px">
                    <input type="text" id="i68" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i70" style="width: 17px">
                    <input type="text" id="i71" style="width: 17px">
                    <input type="text" id="i72" style="width: 17px">
                    <input type="text" id="i73" style="width: 17px">
                    <input type="text" id="i74" style="width: 17px">
                    <input type="text" id="i75" style="width: 17px">
                    <input type="text" id="i76" style="width: 17px">
                    <input type="text" id="i77" style="width: 17px">
                    <input type="text" id="i78" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
                    <input type="text" id="i80" style="width: 17px">
                    <input type="text" id="i81" style="width: 17px">
                    <input type="text" id="i82" style="width: 17px">
                    <input type="text" id="i83" style="width: 17px">
                    <input type="text" id="i84" style="width: 17px">
                    <input type="text" id="i85" style="width: 17px">
                    <input type="text" id="i86" style="width: 17px">
                    <input type="text" id="i87" style="width: 17px">
                    <input type="text" id="i88" style="width: 17px">
                    <div style="margin-bottom: 4px"></div>
            </div>
            <div class="align_center">
                <p style="color: rgb(251, 255, 0)">
                    <input style="margin-bottom: 10px;" type="button" value="Fetch valid (6 examples)"
                        onClick="generateValid()">
                    <br>Alternative input: 1-9 for filled, any other character for unfilled
                    and between lines
                    <input type="button" value="Fill" onClick="fillerRedirect()">
                </p>
                <input style="max-width: 95% !important;" type="text" id="fill" size="85"
                    placeholder="120456098 650980321 ...">

            </div>

            <p style="text-align: center">
                <!--<input type="button" value="Print" onClick="printer(sudo)">
            <input type="button" value="Copy" onClick="copySudoku()">
            <input type="button" value="Print Copy" onClick="printer(sudoSolved)">-->
                <input type="button" value="Solve" onClick="readAndSolve()">
            </p>
            <div class="align_center" id="status" style="color:antiquewhite"></div>
            <div class="align_center" id="sudoku" style="color:antiquewhite"></div>
        </div>
    </form>
    <form>
        <div class="align_center">
            <input class="projects" type="button" value="Contact me!" onClick="window.location.href='ji_contact.html'">
            <input class="projects" type="button" value="Home" onClick="window.location.href='index.html'">

        </div>
    </form>

    <script src="ji_scripts.js"></script>
    <script>
        "use strict;"
        let solutions = 0;
        let sudo = [];
        let sudoSolved = [];
        let displaystatus = 0;
        //let testSudoku = "530070000 600195000 098000060 800060003 400803001 700020006 060000280 000419005 000080079"
        //let testSudokuSolved = "534678912 672195348 198342567 859761423 426853791 713924856 961537284 287419635 345286179"
        for (let i = 0; i < 9; i++) {
            sudo[i] = [];
            sudoSolved[i] = [];
        }

        reader();

        function solver(row, number) {
            let r = row;
            let n = number;
            let i = 1;
            if (n >= 9) {
                // console.log("Solver: line reset");
                n = 0;
                r++;
            }
            if (solutions > 1) {
                return 0;
            }
            if (r >= 9) {
                // console.log("Solver: success condition");
                copySudoku();
                solutions++;
                return 0;
            }
            else if (sudo[r][n] != 0) {
                // console.log("Solver filled cell recursive call")
                return (solver(r, n + 1));
            }
            else {
                while (i <= 9) {
                    //console.log("Solver while status: ", i);
                    sudo[r][n] = i;
                    if (valid(r, n) == 1) {
                        if (solver(r, n + 1) == 1) {
                            return 1;
                        }
                    }
                    sudo[r][n] = 0;
                    i++;
                }
            }
            // console.log("Solver: fail condition");
            return 0;
        }

        function readAndSolve() {
            let teksti;
            let lisa = ".";
            document.getElementById("sudoku").innerHTML = "";
            solutions = 0;
            reader();
            if (validate() == 1) {
                solver(0, 0);
            }
            else {
                lisa = " (invalid input)."
            }
            if (solutions == 1) {
                teksti = "Sudoku valid";
                printer(sudoSolved);
            }
            else if (solutions > 1) {
                teksti = "Sudoku invalid: multiple solutions";
                printer(sudoSolved);
            }
            else {
                teksti = "Sudoku invalid: no solutions";
                printer(sudo);
            }
            teksti = "<h1>" + teksti + lisa + "</h1>"
            document.getElementById("status").innerHTML = teksti;
        }

        function reader() {
            let i = 0;
            let l = 0;
            while (i < 9) {
                sudo[i][l] = document.getElementById("i" + i + l).value;
                if (sudo[i][l] >= 1 && sudo[i][l] <= 9) {
                    sudo[i][l] = Number(sudo[i][l]);
                }
                else {
                    sudo[i][l] = 0;
                }
                l++;
                if (l >= 9) {
                    i++;
                    l = 0;
                }
            }
        }

        function copySudoku() {
            let i = 0;
            let l = 0;

            while (i < 9) {
                if (l == 9) {
                    l = 0;
                    i++;
                    if (i == 9) {
                        break;
                    }
                }
                //console.log("i: ", i, "l: ", l, "sudo: ", sudo[i][l]);
                sudoSolved[i][l] = sudo[i][l];
                l++;
            }
        }

        function printer(sudo) {
            let i = 0;
            let l = 0;
            let teksti = "<p>";
            while (i < 9) {
                if (l < 9) {
                    teksti = teksti + " | "
                }
                teksti = teksti + sudo[i][l];
                l++;
                if (l >= 9) {
                    teksti = teksti + " |<br>";
                    i++;
                    l = 0;
                }
            }
            teksti = teksti + "</p>"
            document.getElementById("sudoku").innerHTML = teksti;
        }

        function validate() {
            let i = 0;
            let l = 0;
            while (i < 9) {
                if (sudo[i][l] != 0) {
                    if (valid(i, l) == 0) {
                        // console.log("validation: fail");
                        return 0;
                    }
                }
                l++;
                if (l >= 9) {
                    l = 0;
                    i++;
                }
            }
            // console.log("validation: meni läpi");
            return 1;
        }

        function valid(row, number) {
            let i = 0;
            let l = 0;

            if (xAndY(row, number) != 1) {
                return 0;
            }
            return threeByThree(row, number);
        }

        function threeByThree(row, number) {
            let i;
            let l;
            let istart;
            let lstart;
            if (row <= 2) {
                i = 0;
            }
            else if (row <= 5) {
                i = 3;
            }
            else {
                i = 6;
            }
            if (number <= 2) {
                l = 0;
            }
            else if (number <= 5) {
                l = 3;
            }
            else {
                l = 6;
            }
            istart = i;
            lstart = l;
            //console.log("3by3 i = ", i);
            //console.log("3by3 l = ", l);
            while (i - istart < 3) {
                if (row != i || number != l) {
                    if (sudo[row][number] == sudo[i][l]) {
                        //console.log("3by3: failas");
                        return 0;
                    }
                }
                l++;
                if (l - lstart >= 3) {
                    l = lstart;
                    i++;
                }
            }
            //console.log("3by3: läpi meni")
            return 1;
        }

        function xAndY(row, number) {
            let i = row;
            let l = 0;
            while (l < 9) {
                if (sudo[row][number] == sudo[i][l] && l != number) {
                    //console.log("xAndY l-loop: failas");
                    return 0;
                }
                //console.log("L-loop status: ", l);
                l++;
            }
            i = 0;
            l = number;
            while (i < 9) {
                if (sudo[row][number] == sudo[i][l] && i != row) {
                    //console.log("xAndY i-loop: failas");
                    return 0;
                }
                //console.log("i-loop status: ", i)
                i++;
            }
            //console.log("xAndY: meni läpi")
            return 1
                ;
        }

        /*function validTest() {
            let y = Number(document.getElementById("validRow").value);
            let x = Number(document.getElementById("validNumber").value);
            // console.log("Valid test: ", valid(y, x));
        }*/

        function fillerRedirect() {
            let sudo = document.getElementById("fill").value.trim();
            filler(sudo);
        }

        function filler(sudo) {
            let i = 0;
            let l = 0;
            let counter = 0;
            while (i < 9) {
                document.getElementById("i" + i + l).value = sudo.charAt(counter);
                counter++;
                l++;
                if (l >= 9) {
                    counter++;
                    l = 0;
                    i++;
                }
            }
        }

        function codeDisplay() {
            let teksti = "";

            if (displaystatus == 1) {
                displaystatus = 0;
            }

            else {
                displaystatus = 1;

                teksti =
                    "function solver(row, number) {     //solver(0, 0) for the first call<br>" +
                    "   let r = row;    //initializing some local variables<br>" +
                    "   let n = number;<br>" +
                    "   let i = 1;<br>" +
                    "   if (n >= 9) {   //row swap<br>" +
                    "       n = 0;<br>" +
                    "       r++;<br>" +
                    "   }<br>" +
                    "   if (solutions > 1) {    //more than one solution = invalid sudoku<br>" +
                    "       return 0;<br>" +
                    "   }<br>" +
                    "   if (r >= 9) {   //solution found<br>" +
                    "       copySudoku();    //calling helper function to save the solution<br>" +
                    "       solutions++;    //+1 to solutions counter<br>" +
                    "       return 0;   //returns fail state to search for more solutions<br>" +
                    "   }<br>" +
                    "   else if (sudo[r][n] != 0) {     //check to skip already filled cells<br>" +
                    "       return (solver(r, n + 1));  //recursive call with n + 1 to skip a filled cell<br>" +
                    "   }<br>" +
                    "   else {      //condition for an empty cell<br> " +
                    "       while (i <= 9) {    //loop to see if any 1-9 value fits<br>" +
                    "           sudo[r][n] = i;     //current cell gets i value<br>" +
                    "           if (valid(r, n) == 1) {     //helper function call to see if current number fits<br>" +
                    "               if (solver(r, n + 1) == 1) {    //recursive call inside the if clause<br>" +
                    "                   return 1;   //leftover from an earlier implementation, cannot happen<br>" +
                    "               }<br>" +
                    "           }<br>" +
                    "           sudo[r][n] = 0;     //resets current cell to default state<br>" +
                    "           i++;<br>" +
                    "       }<br>" +
                    "   }<br>" +
                    "   return 0;   //no number 1-9 fit, returning fail state to terminate this branch<br>" +
                    "}<br>//this function has finished and another function handles the rest"
            }
            document.getElementById("codeDisplay").innerHTML = teksti;

        }

        function generateValid() {
            let sudoku = ["530070000 600195000 098000060 800060003 400803001 700020006 060000280 000419005 000080079",
                "830000009 000050000 006407200 005020000 000010300 600305080 000100000 040000020 007603400",
                "006000900 382000000 004000605 000000008 000208060 400300002 030040000 000050170 700006000",
                "130500070 000030002 760900500 000000903 900003080 000091004 870600305 000004000 009150006",
                "008072000 000050060 900608500 090010435 001004200 000065001 805003009 074000600 000700308",
                "009813057 530607080 807000013 070080560 900451378 005030420 000175000 000009740 703000000"]

            filler(sudoku[Math.floor(Math.random() * sudoku.length)]);
        }

    </script>
</body>

</html>